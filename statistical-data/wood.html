
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>木材需給表 見える化</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    canvas { margin-bottom: 50px; }
  </style>
</head>
<body>
  <h1>木材需給表 見える化</h1>

  <h2>国内生産・輸入の推移（積み上げ＋総需要ライン）</h2>
  <canvas id="chart-supply"></canvas>

  <h2>用途別構成（合計値）</h2>
  <canvas id="chart-usage"></canvas>

  <h2>用途別自給率推移</h2>
  <canvas id="chart-selfsufficiency"></canvas>

  <script>
    Papa.parse('wood_data.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;

        const years = data.map(row => row['年次']);
        const domestic = data.map(row => +row['国内生産']);
        const imports = data.map(row => +row['輸入']);
        const totalDemand = data.map(row => +row['総需要量']);

        // グラフ① 国内生産・輸入の積み上げ＋総需要ライン
        new Chart(document.getElementById('chart-supply'), {
          type: 'bar',
          data: {
            labels: years,
            datasets: [
              {
                label: '国内生産',
                data: domestic,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                stack: 'stack1'
              },
              {
                label: '輸入',
                data: imports,
                backgroundColor: 'rgba(255, 99, 132, 0.7)',
                stack: 'stack1'
              },
              {
                label: '総需要量',
                data: totalDemand,
                type: 'line',
                borderColor: 'black',
                borderWidth: 2,
                fill: false,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '数量（千m³）' },
                stacked: true
              },
              x: {
                stacked: true
              }
            }
          }
        });

        // グラフ② 用途別構成
        new Chart(document.getElementById('chart-usage'), {
          type: 'bar',
          data: {
            labels: years,
            datasets: [
              { label: '製材用合計', data: data.map(r => +r['製材用合計']), stack: 'stack2' },
              { label: '合板用合計', data: data.map(r => +r['合板用合計']), stack: 'stack2' },
              { label: 'パルプ・チップ用合計', data: data.map(r => +r['パルプ・チップ用合計']), stack: 'stack2' },
              { label: 'その他用合計', data: data.map(r => +r['その他用合計']), stack: 'stack2' },
              { label: 'しいたけ原木合計', data: data.map(r => +r['しいたけ原木合計']), stack: 'stack2' },
              { label: '燃料材合計', data: data.map(r => +r['燃料材合計']), stack: 'stack2' }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '数量（千m³）' },
                stacked: true
              },
              x: {
                stacked: true
              }
            }
          }
        });

        // グラフ③ 用途別自給率推移
        new Chart(document.getElementById('chart-selfsufficiency'), {
          type: 'line',
          data: {
            labels: years,
            datasets: [
              { label: '製材用自給率', data: data.map(r => +r['製材用自給率']), borderColor: 'blue', fill: false },
              { label: '合板用自給率', data: data.map(r => +r['合板用自給率']), borderColor: 'green', fill: false },
              { label: 'パルプ用自給率', data: data.map(r => +r['パルプ用自給率']), borderColor: 'orange', fill: false },
              { label: 'その他用自給率', data: data.map(r => +r['その他用自給率']), borderColor: 'purple', fill: false },
              { label: 'しいたけ自給率', data: data.map(r => +r['しいたけ自給率']), borderColor: 'brown', fill: false },
              { label: '燃料材自給率', data: data.map(r => +r['燃料材自給率']), borderColor: 'gray', fill: false }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '自給率（％）' }
              }
            }
          }
        });
      }
    });
  </script>
</body>
</html>
