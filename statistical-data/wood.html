
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>見える化プロジェクト／木材需給表</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    canvas { margin-bottom: 50px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { padding: 8px; border: 1px solid #ccc; }
    th { background-color: #f0f0f0; }
    p { font-size: 0.9em; margin-top: 10px; margin-bottom: 40px; }
  </style>
</head>
<body>
  <h1>木材需給の状況を見える化</h1>

  <table>
    <tr><th>データ名</th><td>木材需給表</td></tr>
    <tr><th>データ作成</th><td>農林水産省</td></tr>
    <tr><th>元データURL</th><td><a href="https://www.maff.go.jp/j/tokei/kouhyou/mokuzai_zyukyu/" target="_blank">https://www.maff.go.jp/j/tokei/kouhyou/mokuzai_zyukyu/</a></td></tr>
    <tr><th>グラフ用データ</th><td><a href="wood_data.csv" target="_blank">wood_data.csv</a></td></tr>
  </table>

  <h2>国内生産・輸入の推移</h2>
  <canvas id="chart-supply"></canvas>
  <p>需要としては一時的に減少傾向となったが、ここ十年ほどで少しずつ伸び傾向にある。自給率も一時期は10%台まで減少したものの昨今では40%台を超えるなど、自給率が高まってきていることがわかる。</p>

  <h2>用途別構成（合計値）</h2>
  <canvas id="chart-usage"></canvas>
  <p>製材、合板材としての需要は減少傾向にあり、一方で燃料材としての需要が増え始めていることが分かる。2014年頃から増え始めたという傾向を見ても、原発停止に伴う電力不足がこれを引き上げる要因となったことが推測できる。</p>
  
  <table>
    <tr><th>木質バイオマスの利用推進について</th><td>林野庁</td><td><a href="https://www.rinya.maff.go.jp/j/riyou/biomass/index.html" target="_blank">https://www.rinya.maff.go.jp/j/riyou/biomass/index.html</a></td></tr>
  </table>

  <h2>用途別自給率推移</h2>
  <canvas id="chart-selfsufficiency"></canvas>
  <p>木材に関しては突如として需給の大きな変化がおとずれるパターンがいくつか散見される。製材・合板についてはジワジワと自給率が高まっていることが分かる。</p>

  <script>
    Papa.parse('wood_data.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;

        const years = data.map(row => row['年次']);
        const domestic = data.map(row => +row['国内生産']);
        const imports = data.map(row => +row['輸入']);
        const totalDemand = data.map(row => +row['総需要量']);
        const overallSelfSufficiency = data.map(row => +row['全体自給率']); // ここだけ読む！

        // グラフ① 国内生産・輸入の積み上げ＋総需要ライン＋自給率ライン
        new Chart(document.getElementById('chart-supply'), {
          data: {
            labels: years,
            datasets: [
              {
                label: '国内生産',
                data: domestic,
                type: 'bar',
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                stack: 'stack1',
                yAxisID: 'y'
              },
              {
                label: '輸入',
                data: imports,
                type: 'bar',
                backgroundColor: 'rgba(255, 99, 132, 0.7)',
                stack: 'stack1',
                yAxisID: 'y'
              },
              {
                label: '総需要量',
                data: totalDemand,
                type: 'line',
                borderColor: 'black',
                borderWidth: 2,
                fill: false,
                pointRadius: 0,
                yAxisID: 'y'
              },
              {
                label: '全体自給率（％）',
                data: overallSelfSufficiency,
                type: 'line',
                borderColor: 'blue',
                borderDash: [5, 5],
                borderWidth: 2,
                fill: false,
                pointRadius: 2,
                yAxisID: 'y2'
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '数量（千m³）' },
                stacked: true,
                position: 'left'
              },
              y2: {
                title: { display: true, text: '自給率（％）' },
                position: 'right',
                grid: { drawOnChartArea: false },
                min: 0,
                max: 100
              },
              x: {
                stacked: true
              }
            }
          }
        });

        // グラフ② 用途別構成
        new Chart(document.getElementById('chart-usage'), {
          type: 'bar',
          data: {
            labels: years,
            datasets: [
              { label: '製材用合計', data: data.map(r => +r['製材用合計']), stack: 'stack2' },
              { label: '合板用合計', data: data.map(r => +r['合板用合計']), stack: 'stack2' },
              { label: 'パルプ・チップ用合計', data: data.map(r => +r['パルプ・チップ用合計']), stack: 'stack2' },
              { label: 'その他用合計', data: data.map(r => +r['その他用合計']), stack: 'stack2' },
              { label: 'しいたけ原木合計', data: data.map(r => +r['しいたけ原木合計']), stack: 'stack2' },
              { label: '燃料材合計', data: data.map(r => +r['燃料材合計']), stack: 'stack2' }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '数量（千m³）' },
                stacked: true
              },
              x: {
                stacked: true
              }
            }
          }
        });

        // グラフ③ 用途別自給率推移
        new Chart(document.getElementById('chart-selfsufficiency'), {
          type: 'line',
          data: {
            labels: years,
            datasets: [
              { label: '製材用自給率', data: data.map(r => +r['製材用自給率']), borderColor: 'blue', fill: false },
              { label: '合板用自給率', data: data.map(r => +r['合板用自給率']), borderColor: 'green', fill: false },
              { label: 'パルプ用自給率', data: data.map(r => +r['パルプ用自給率']), borderColor: 'orange', fill: false },
              { label: 'その他用自給率', data: data.map(r => +r['その他用自給率']), borderColor: 'purple', fill: false },
              { label: 'しいたけ自給率', data: data.map(r => +r['しいたけ自給率']), borderColor: 'brown', fill: false },
              { label: '燃料材自給率', data: data.map(r => +r['燃料材自給率']), borderColor: 'gray', fill: false }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                title: { display: true, text: '自給率（％）' }
              }
            }
          }
        });
      }
    });
  </script>
</body>
</html>
