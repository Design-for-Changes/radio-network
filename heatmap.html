<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>投稿数ヒートマップ</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .cell { stroke: #ccc; }
    .label { font-size: 12px; }
  </style>
</head>
<body>
  <h2>ユーザー × 曜日 投稿数ヒートマップ</h2>
  <svg id="chart" width="1000" height="600"></svg>

  <script>
    const cellSize = 30;
    const weekdays = ["月", "火", "水", "木", "金", "土", "日"];

    d3.json("./user_weekday_stats.json").then(data => {
      const users = Array.from(new Set(data.map(d => d.user.trim()))).sort();
      const svg = d3.select("#chart");
      
      const color = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.post_count)])
        .range(["#ffffff", "#1f77b4"]);

      // ラベル：曜日
      svg.selectAll(".colLabel")
        .data(weekdays)
        .enter()
        .append("text")
        .attr("x", (d, i) => i * cellSize + 60)
        .attr("y", 30)
        .attr("class", "label")
        .text(d => d);

      // ラベル：ユーザー
      svg.selectAll(".rowLabel")
        .data(users)
        .enter()
        .append("text")
        .attr("x", 0)
        .attr("y", (d, i) => i * cellSize + 60)
        .attr("dy", "0.9em")
        .attr("class", "label")
        .text(d => d);

      // セル描画
      svg.selectAll(".cell")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", d => weekdays.indexOf(d.weekday_name.trim()) * cellSize + 60)
        .attr("y", d => users.indexOf(d.user.trim()) * cellSize + 50)
        .attr("width", cellSize)
        .attr("height", cellSize)
        .attr("fill", d => color(d.post_count));

    }).catch(err => console.error("読み込みエラー:", err));
  </script>
</body>
</html>